<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="css/splide.min.css">
  <link rel="stylesheet" href="css/leaflet.css">
  <link rel="stylesheet" href="css/style.css">
  <link rel="icon" type="image/x-icon" href="favicon.ico">
  <title>PANTAU | Dashboard</title>
</head>
<body style="overflow-x: hidden">
  <nav>
    <a href="/" class="logo">
      <img src="images/logo.png" alt="">
    </a>
    <ul class="menus">
      <li>Hello, <span class="username-placeholder"></span>!</li>
      <li><a href="login.html" class="login">Logout</a></li>
    </ul>
    <a href="#" class="hamburger">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"><path d="M24 6h-24v-4h24v4zm0 4h-24v4h24v-4zm0 8h-24v4h24v-4z"/></svg>
    </a>
  </nav>
  <div class="content dashboard-content">
    <div id="map"></div>
    <div class="toolbar">
      <div class="toolbar-toggle">
        <a href="#">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"><path d="M16.67 0l2.83 2.829-9.339 9.175 9.339 9.167-2.83 2.829-12.17-11.996z"/></svg>
        </a>
      </div>
      <div class="toolbar-content">
        <div class="person-status person-1">
          <p class="person-name">Device 1</p>
          <p>Suhu: <span class="person-suhu"></span></p>
          <p>spo2: <span class="person-spo2"></span></p>
          <p>Heart Rate: <span class="person-hr"></span></p>
          <p>Longitude: <span class="person-long"></span></p> 
          <p>Altitude: <span class="person-alt"></span></p> 
        </div>
        <div class="person-status person-2">
          <p class="person-name">Device 2</p>
          <p>Suhu: <span class="person-suhu"></span></p>
          <p>spo2: <span class="person-spo2"></span></p>
          <p>Heart Rate: <span class="person-hr"></span></p>
          <p>Longitude: <span class="person-lt"></span></p>
          <p>Altitude: <span class="person-alt"></span></p> 
        </div>
        <div class="person-status person-3">
          <p class="person-name">Device 3</p>
          <p>Suhu: <span class="person-suhu"></span></p>
          <p>spo2: <span class="person-spo2"></span></p>
          <p>Heart Rate: <span class="person-hr"></span></p>
          <p>Longitude: <span class="person-lt"></span></p>
          <p>Altitude: <span class="person-alt"></span></p> 
        </div>
        <div class="person-status person-4">
          <p class="person-name">Device 4</p>
          <p>Suhu: <span class="person-suhu"></span></p>
          <p>spo2: <span class="person-spo2"></span></p>
          <p>Heart Rate: <span class="person-hr"></span></p>
          <p>Longitude: <span class="person-lt"></span></p>
          <p>Altitude: <span class="person-alt"></span></p> 
        </div>
      </div>
    </div>
  </div>


  <script src="js/leaflet.js"></script>
  <script src="js/main.js"></script>
  <script>
    var name = localStorage.getItem("username");

    document.querySelector('.login').addEventListener('click', (e)=>{
      e.preventDefault();
      localStorage.removeItem('username');
      window.location.href = '/login.html';
    })
    
    document.addEventListener('DOMContentLoaded', ()=>{
      if (name == '' || name == 'null'){
        alert('You need to login to access this page!');
        window.location.href = '/login.html';
      } else{
        document.querySelector('.username-placeholder').innerHTML = name;
      }
      
      document.querySelector('.toolbar-toggle').querySelector('a').addEventListener('click', ()=>{
        document.querySelector('.toolbar').classList.toggle('toolbar-active');
        if (document.querySelector('.toolbar').classList.contains('toolbar-active')){
          document.querySelector('.toolbar-toggle').querySelector('path').attributes.d.value = "M5 3l3.057-3 11.943 12-11.943 12-3.057-3 9-9z";
        } else {
          document.querySelector('.toolbar-toggle').querySelector('path').attributes.d.value = "M16.67 0l2.83 2.829-9.339 9.175 9.339 9.167-2.83 2.829-12.17-11.996z";
        }
      })

      var map = L.map('map').setView([-6.362480397433, 106.82404411061857], 16);
      // var map = L.map('map').setView([51.508, -0.11], 16);

      L.tileLayer('https://api.maptiler.com/maps/streets/{z}/{x}/{y}.png?key=vPVqdMuRowKnXesdqmzl', {
        attribution: '<a href="https://www.maptiler.com/copyright/" target="_blank">&copy; MapTiler</a> <a href="https://www.openstreetmap.org/copyright" target="_blank">&copy; OpenStreetMap contributors</a>',
        maxZoom: 18,
        id: 'mapbox/streets-v11',
        tileSize: 512,
        zoomOffset: -1,
      }).addTo(map);

      var markerIcon = L.Icon.extend({
          options: {
            shadowUrl: 'css/images/marker-shadow.png',

            iconSize:     [40, 40], // size of the icon
            shadowSize:   [41, 41], // size of the shadow
            iconAnchor:   [20, 40], // point of the icon which will correspond to marker's location
            shadowAnchor: [12, 39],  // the same for the shadow
            popupAnchor:  [0, -40] // point from which the popup should open relative to the iconAnchor
          }
      });

      var greenIcon = new markerIcon({iconUrl: 'css/images/marker-green.png'}),
      redIcon = new markerIcon({iconUrl: 'css/images/marker-red.png'}),
      yellowIcon = new markerIcon({iconUrl: 'css/images/marker-yellow.png'});

      var circle = L.circle([-6.362480397433, 106.82404411061857], {
          color: 'red',
          fillColor: '#f03',
          fillOpacity: 0.3,
          radius: 200
      }).addTo(map);
      
      var marker_1 = L.marker([-6.362480397433, 106.82404411061857], {icon: greenIcon}).addTo(map);

      // marker.bindPopup("<b class='bold'>Hello world!</b><br>I am a popup.").openPopup();
      setTimeout(() =>{
        marker_1.setLatLng([-6.36, 106.82404411061857])
        marker_1.setIcon(yellowIcon)
      }, 2000)

      // var popup = L.popup();
      // function onMapClick(e) {
      //     popup
      //         .setLatLng(e.latlng)
      //         .setContent("You clicked the map at <br>" + e.latlng.toString())
      //         .openOn(map);
      // }
      // map.on('click', onMapClick);
    })    
  </script>
</body>
</html>